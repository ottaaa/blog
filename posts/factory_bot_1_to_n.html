<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><meta name="description" content="oootta blog"/><meta property="og:image" content="https://og-image.vercel.app/oootta%20blog.png?theme=light&amp;md=0&amp;fontSize=75px&amp;images=https%3A%2F%2Fassets.zeit.co%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fnextjs-black-logo.svg"/><meta name="og:title" content="oootta blog"/><meta name="twitter:card" content="summary_large_image"/><title>FactoryBotで親子関係にあるモデルを複数作成する(子ごとに別々の親)</title><meta name="next-head-count" content="8"/><link rel="preload" href="/_next/static/css/704bc9099188160c85ce.css" as="style"/><link rel="stylesheet" href="/_next/static/css/704bc9099188160c85ce.css" data-n-g=""/><link rel="preload" href="/_next/static/css/a9cddbe46aafbdb983f6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a9cddbe46aafbdb983f6.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-572c81794b725ca82049.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework-b3704ce4364a8f87fb84.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons-7c714cbe873fbe378577.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-1617eb7af78f4b63f974.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-6cc6db7e2330cb594f13.js" as="script"/><link rel="preload" href="/_next/static/chunks/941-22a6e325763dad2c5dc4.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bid%5D-ebe198459aaa8c598afc.js" as="script"/></head><body><div id="__next"><div class="layout_container__2t4v2"><main><article><h1 class="utils_headingXl__1XecN">FactoryBotで親子関係にあるモデルを複数作成する(子ごとに別々の親)</h1><div class="utils_lightText__12Ckm"><time dateTime="2021-05-08">May 8, 2021</time></div><div><h2>結論</h2>
<pre><code class="language-ruby">FactoryBot.define do
  factory :post do
    title { "Through the Looking Glass" }
    user
  end

  factory :user do
    name { "Rachel Sanchez" }
  end
end

def user_with_posts(posts_count: 5)
  FactoryBot.create(:user) do |user|
    FactoryBot.create_list(:post, posts_count, user: user)
  end
end
</code></pre>
<p>下記から引用(2021-05-07)<br>
https://github.com/thoughtbot/factory_bot/blob/master/GETTING_STARTED.md#has_many-associations</p>
<h2>経緯</h2>
<pre><code class="language-ruby">FactoryBot.create_list(:post, 3, user: FactoryBot.create(:user)) 
</code></pre>
<p>当初上記の書き方をしていた。<br>
各postにつき別々のuserが関連づけられると想定していたが、共通した親が関連づけられる。</p>
<pre><code>FactoryBot.create(:user) do |user|
  FactoryBot.create_list(:post, posts_count, user: user)
end
</code></pre>
<p>引用のこの部分の実装で、子ごとに別々の親をもつモデルを作成できる。</p>
</div></article></main><div class="layout_backToHome__1vZsp"><a href="/">← 記事一覧へ</a></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"factory_bot_1_to_n","contentHtml":"\u003ch2\u003e結論\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"language-ruby\"\u003eFactoryBot.define do\n  factory :post do\n    title { \"Through the Looking Glass\" }\n    user\n  end\n\n  factory :user do\n    name { \"Rachel Sanchez\" }\n  end\nend\n\ndef user_with_posts(posts_count: 5)\n  FactoryBot.create(:user) do |user|\n    FactoryBot.create_list(:post, posts_count, user: user)\n  end\nend\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e下記から引用(2021-05-07)\u003cbr\u003e\nhttps://github.com/thoughtbot/factory_bot/blob/master/GETTING_STARTED.md#has_many-associations\u003c/p\u003e\n\u003ch2\u003e経緯\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"language-ruby\"\u003eFactoryBot.create_list(:post, 3, user: FactoryBot.create(:user)) \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e当初上記の書き方をしていた。\u003cbr\u003e\n各postにつき別々のuserが関連づけられると想定していたが、共通した親が関連づけられる。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eFactoryBot.create(:user) do |user|\n  FactoryBot.create_list(:post, posts_count, user: user)\nend\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e引用のこの部分の実装で、子ごとに別々の親をもつモデルを作成できる。\u003c/p\u003e\n","title":"FactoryBotで親子関係にあるモデルを複数作成する(子ごとに別々の親)","date":"2021-05-08"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"factory_bot_1_to_n"},"buildId":"XY4JWZGSN8EsdzPm-3oho","isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-8683bd742a84c1edd48c.js"></script><script src="/_next/static/chunks/webpack-572c81794b725ca82049.js" async=""></script><script src="/_next/static/chunks/framework-b3704ce4364a8f87fb84.js" async=""></script><script src="/_next/static/chunks/commons-7c714cbe873fbe378577.js" async=""></script><script src="/_next/static/chunks/main-1617eb7af78f4b63f974.js" async=""></script><script src="/_next/static/chunks/pages/_app-6cc6db7e2330cb594f13.js" async=""></script><script src="/_next/static/chunks/941-22a6e325763dad2c5dc4.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-ebe198459aaa8c598afc.js" async=""></script><script src="/_next/static/XY4JWZGSN8EsdzPm-3oho/_buildManifest.js" async=""></script><script src="/_next/static/XY4JWZGSN8EsdzPm-3oho/_ssgManifest.js" async=""></script></body></html>