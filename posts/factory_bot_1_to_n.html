<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><meta name="description" content="oootta blog"/><meta property="og:image" content="https://og-image.vercel.app/oootta%20blog.png?theme=light&amp;md=0&amp;fontSize=75px&amp;images=https%3A%2F%2Fassets.zeit.co%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fnextjs-black-logo.svg"/><meta name="og:title" content="oootta blog"/><meta name="twitter:card" content="summary_large_image"/><title>FactoryBotで親子関係にあるモデルを複数作成する(子ごとに別々の親)</title><meta name="next-head-count" content="8"/><link rel="preload" href="/_next/static/css/d956bfbeac7a7df3d68f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/d956bfbeac7a7df3d68f.css" data-n-g=""/><link rel="preload" href="/_next/static/css/960c0da36687fee2a3db.css" as="style"/><link rel="stylesheet" href="/_next/static/css/960c0da36687fee2a3db.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-fb76148cfcfb42ca18eb.js" defer=""></script><script src="/_next/static/chunks/framework-1a85486469afb3278dba.js" defer=""></script><script src="/_next/static/chunks/main-8d15616dad332ac01c02.js" defer=""></script><script src="/_next/static/chunks/pages/_app-dbfb39d2c6bc7bbd7b3a.js" defer=""></script><script src="/_next/static/chunks/941-b533ee67c058e7df0ccc.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-fb5f99cd10b4fa6552f1.js" defer=""></script><script src="/_next/static/LrMQZLDD09F6-cPP8ppVZ/_buildManifest.js" defer=""></script><script src="/_next/static/LrMQZLDD09F6-cPP8ppVZ/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="layout_container__2t4v2"><main><article><h1 class="utils_headingXl__1XecN">FactoryBotで親子関係にあるモデルを複数作成する(子ごとに別々の親)</h1><div class="utils_lightText__12Ckm"><time dateTime="2021-05-08">May 8, 2021</time></div><div class="markdown-body"><h2>結論</h2>
<pre><code>FactoryBot.define do
  factory :post do
    title { "Through the Looking Glass" }
    user
  end

  factory :user do
    name { "Rachel Sanchez" }
  end
end

def user_with_posts(posts_count: 5)
  FactoryBot.create(:user) do |user|
    FactoryBot.create_list(:post, posts_count, user: user)
  end
end
</code></pre>
<p>下記から引用(2021-05-07)
<a href="https://github.com/thoughtbot/factory_bot/blob/master/GETTING_STARTED.md#has_many-associations">https://github.com/thoughtbot/factory_bot/blob/master/GETTING_STARTED.md#has_many-associations</a></p>
<h2>経緯</h2>
<pre><code>FactoryBot.create_list(:post, 3, user: FactoryBot.create(:user)) 
</code></pre>
<p>当初上記の書き方をしていた。
各postにつき別々のuserが関連づけられると想定していたが、共通した親が関連づけられる。</p>
<pre><code>FactoryBot.create(:user) do |user|
  FactoryBot.create_list(:post, posts_count, user: user)
end
</code></pre>
<p>引用のこの部分の実装で、子ごとに別々の親をもつモデルを作成できる。</p>
</div></article></main><div class="layout_backToHome__1vZsp"><a href="/">← 記事一覧へ</a></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"factory_bot_1_to_n","contentHtml":"\u003ch2\u003e結論\u003c/h2\u003e\n\u003cpre\u003e\u003ccode\u003eFactoryBot.define do\n  factory :post do\n    title { \"Through the Looking Glass\" }\n    user\n  end\n\n  factory :user do\n    name { \"Rachel Sanchez\" }\n  end\nend\n\ndef user_with_posts(posts_count: 5)\n  FactoryBot.create(:user) do |user|\n    FactoryBot.create_list(:post, posts_count, user: user)\n  end\nend\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e下記から引用(2021-05-07)\n\u003ca href=\"https://github.com/thoughtbot/factory_bot/blob/master/GETTING_STARTED.md#has_many-associations\"\u003ehttps://github.com/thoughtbot/factory_bot/blob/master/GETTING_STARTED.md#has_many-associations\u003c/a\u003e\u003c/p\u003e\n\u003ch2\u003e経緯\u003c/h2\u003e\n\u003cpre\u003e\u003ccode\u003eFactoryBot.create_list(:post, 3, user: FactoryBot.create(:user)) \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e当初上記の書き方をしていた。\n各postにつき別々のuserが関連づけられると想定していたが、共通した親が関連づけられる。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eFactoryBot.create(:user) do |user|\n  FactoryBot.create_list(:post, posts_count, user: user)\nend\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e引用のこの部分の実装で、子ごとに別々の親をもつモデルを作成できる。\u003c/p\u003e\n","title":"FactoryBotで親子関係にあるモデルを複数作成する(子ごとに別々の親)","date":"2021-05-08"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"factory_bot_1_to_n"},"buildId":"LrMQZLDD09F6-cPP8ppVZ","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>